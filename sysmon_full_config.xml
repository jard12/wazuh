<Sysmon schemaversion="4.90">
  <HashAlgorithms>sha256,md5</HashAlgorithms>

  <EventFiltering>

    <!-- ========== PROCESS CREATION (cmdline) ========== -->
    <ProcessCreate onmatch="include">
      <CommandLine condition="is">*</CommandLine>
    </ProcessCreate>

    <!-- ========== NETWORK CONNECT (browsers & cli-downloaders) ========== -->
    <NetworkConnect onmatch="include">
      <Image condition="end with">chrome.exe</Image>
      <Image condition="end with">msedge.exe</Image>
      <Image condition="end with">firefox.exe</Image>
      <Image condition="end with">powershell.exe</Image>
      <Image condition="end with">pwsh.exe</Image>
      <Image condition="end with">cmd.exe</Image>
      <Image condition="end with">curl.exe</Image>
      <Image condition="end with">wget.exe</Image>
    </NetworkConnect>

    <!-- ========== DNS QUERIES ========== -->
    <DnsQuery onmatch="include">
      <QueryName condition="is">*</QueryName>
    </DnsQuery>

    <!-- ========== FILE CREATE (géén extensie-filter; alle typen) ========== -->
    <!-- Pakt zowel New-Item/WriteAllText als browser downloads (ook .crdownload -> rename) -->
    <FileCreate onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
      <TargetFilename condition="contains">\Program Files\</TargetFilename>
      <TargetFilename condition="contains">\Program Files (x86)\</TargetFilename>
      <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
    </FileCreate>

    <!-- ========== FILE DELETE (Recycle Bin + gewone deletes) ========== -->
    <FileDelete onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
      <TargetFilename condition="contains">\Program Files\</TargetFilename>
      <TargetFilename condition="contains">\Program Files (x86)\</TargetFilename>
      <TargetFilename condition="contains">\$Recycle.Bin\</TargetFilename>
    </FileDelete>

    <!-- ========== FILE DELETE DETECTED (permanent) ========== -->
    <FileDeleteDetected onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
      <TargetFilename condition="contains">\Program Files\</TargetFilename>
      <TargetFilename condition="contains">\Program Files (x86)\</TargetFilename>
    </FileDeleteDetected>

    <!-- ========== FILE CREATE TIME (mtime/ctime flips in Users) ========== -->
    <FileCreateTime onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
    </FileCreateTime>

    <!-- ========== FILE STREAM HASH (hashes op user- & app-paden) ========== -->
    <FileCreateStreamHash onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
      <TargetFilename condition="contains">\Program Files\</TargetFilename>
      <TargetFilename condition="contains">\Program Files (x86)\</TargetFilename>
    </FileCreateStreamHash>

    <!-- ========== EXCLUDES (OS-ruis) ========== -->
    <FileCreate onmatch="exclude">
      <TargetFilename condition="begin with">C:\Windows\</TargetFilename>
      <TargetFilename condition="contains">\WinSxS\</TargetFilename>
      <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Windows Defender\</TargetFilename>
      <TargetFilename condition="contains">\AppData\Local\Microsoft\Windows\INetCache\</TargetFilename>
      <TargetFilename condition="end with">.etl</TargetFilename>
      <!-- voorkom agent/system noise in $Recycle.Bin van LocalSystem -->
      <TargetFilename condition="begin with">C:\$Recycle.Bin\S-1-5-18\</TargetFilename>
    </FileCreate>

  </EventFiltering>
</Sysmon>
