<Sysmon schemaversion="4.90">
  <HashAlgorithms>sha256,md5</HashAlgorithms>

  <EventFiltering>

    <!-- ========= PROCESS CREATION ========= -->
    <ProcessCreate onmatch="include">
      <CommandLine condition="is">*</CommandLine>
    </ProcessCreate>

    <!-- ========= NETWORK ========= -->
    <NetworkConnect onmatch="include">
      <Image condition="end with">chrome.exe</Image>
      <Image condition="end with">msedge.exe</Image>
      <Image condition="end with">firefox.exe</Image>
      <Image condition="end with">curl.exe</Image>
      <Image condition="end with">wget.exe</Image>

  <!-- Mail & test tools -->
      <Image condition="end with">powershell.exe</Image>
      <Image condition="end with">pwsh.exe</Image>
      <Image condition="end with">outlook.exe</Image>
      <Image condition="end with">thunderbird.exe</Image>

  <!-- optioneel: poorten om noise te beperken -->
      <DestinationPort condition="is">25</DestinationPort>
      <DestinationPort condition="is">465</DestinationPort>
      <DestinationPort condition="is">587</DestinationPort>
      <DestinationPort condition="is">993</DestinationPort>
      <DestinationPort condition="is">995</DestinationPort>
      <DestinationPort condition="is">143</DestinationPort>
      <DestinationPort condition="is">110</DestinationPort>
    </NetworkConnect>

    <!-- ========= DNS ========= -->
    <DnsQuery onmatch="include">
      <QueryName condition="is">*</QueryName>
    </DnsQuery>

    <!-- ========= FILE CREATE ========= -->
    <FileCreate onmatch="include">
      <!-- Gebruikerslocaties + installers/scripts -->
      <TargetFilename condition="contains">\Downloads\</TargetFilename>
<!--      <TargetFilename condition="contains">\Users\</TargetFilename>
      <TargetFilename condition="contains">\Desktop\</TargetFilename>
      <TargetFilename condition="contains">\Documents\</TargetFilename>
      <TargetFilename condition="contains">\Program Files\</TargetFilename>
      <TargetFilename condition="contains">\Program Files (x86)\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <TargetFilename condition="end with">.msi</TargetFilename>
      <TargetFilename condition="end with">.zip</TargetFilename>
      <TargetFilename condition="end with">.ps1</TargetFilename>
      <TargetFilename condition="end with">.bat</TargetFilename>
      <TargetFilename condition="end with">.vbs</TargetFilename>
      <TargetFilename condition="end with">.jpg</TargetFilename>
      <TargetFilename condition="end with">.png</TargetFilename>
      <TargetFilename condition="end with">.webp</TargetFilename>
      <TargetFilename condition="end with">.pdf</TargetFilename> -->
    </FileCreate>

    <!-- ========= FILE DELETE ========= -->
    <!-- 23 = File Delete archived (NTFS), 26 = File Delete (Purge) -->
    <FileDelete onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
      <TargetFilename condition="contains">\$Recycle.Bin\</TargetFilename>
    </FileDelete>

    <FileDeleteDetected onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
      <TargetFilename condition="contains">\$Recycle.Bin\</TargetFilename>
    </FileDeleteDetected>

    <!-- ========= FILE WRITE TIME ========= -->
    <FileCreateTime onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
    </FileCreateTime>

    <!-- ========= FILE STREAM HASH ========= -->
    <FileCreateStreamHash onmatch="include">
      <TargetFilename condition="contains">\Users\</TargetFilename>
    </FileCreateStreamHash>

    <!-- ========= EXCLUDES (ruis beperken) ========= -->
    <!-- Windows-ruis, Defender, WinSxS, Temp/Cache en Recent .lnkâ€™s -->
    <FileCreate onmatch="exclude">
      <TargetFilename condition="begin with">C:\Windows\</TargetFilename>
      <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Windows Defender\</TargetFilename>
      <TargetFilename condition="contains">\WinSxS\</TargetFilename>
      <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
      <TargetFilename condition="contains">\AppData\Local\Microsoft\Windows\INetCache\</TargetFilename>
      <TargetFilename condition="contains">\AppData\Roaming\Microsoft\Windows\Recent\</TargetFilename>
      <TargetFilename condition="end with">.lnk</TargetFilename>
    </FileCreate>

  </EventFiltering>
</Sysmon>
